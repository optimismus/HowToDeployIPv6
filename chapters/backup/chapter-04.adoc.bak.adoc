////
[upperroman, start=4]
. [#_Toc90246665 .anchor]####Addressing +
plan
4
link:#public-or-private[◗ PUBLIC OR PRIVATE? link:#public-or-private[56]]
link:#small-organization[◗ SMALL ORGANIZATION link:#small-organization[56]]
link:#_Toc88922671[ULA link:#_Toc88922671[56]]
link:#_Toc88922672[Provider-Independent (PI) Prefix link:#_Toc88922672[57]]
link:#_Toc88922673[NPTv6 drawbacks link:#_Toc88922673[57]]
link:#large-organization[◗ LARGE ORGANIZATION link:#large-organization[58]]
link:#_Toc88922675[Management of direct internet access link:#_Toc88922675[58]]
link:#logical-groups[◗ LOGICAL GROUPS link:#logical-groups[59]]
link:#building-blocks[◗ BUILDING BLOCKS link:#building-blocks[60]]
link:#prefix-size[◗ PREFIX SIZE link:#prefix-size[62]]
link:#_Toc88922679[Standard link:#_Toc88922679[62]]
link:#_Toc88922680[Interconnection link:#_Toc88922680[62]]
link:#common-sercvices-addresses[◗ COMMON SERCVICES ADDRESSES link:#common-sercvices-addresses[63]]
link:#time-scale-evolution[◗ TIME-SCALE EVOLUTION link:#time-scale-evolution[64]]
link:#use-of-host-number-0[◗ USE OF HOST NUMBER 0 link:#use-of-host-number-0[65]]
link:#per-interface-isolation[◗ PER INTERFACE ISOLATION link:#per-interface-isolation[65]]
link:#empreintes-contour-ip-v4-v6-mapping[◗ IP V4 / V6 MAPPING link:#empreintes-contour-ip-v4-v6-mapping[66]]
link:#_Toc88922686[Network prefix number link:#_Toc88922686[66]]
link:#_Toc88922687[Host number / Interface ID link:#_Toc88922687[67]]
link:#for-native-v6-networks[◗ FOR NATIVE V6 NETWORKS link:#for-native-v6-networks[69]]
link:#public-announces[◗ PUBLIC ANNOUNCES link:#public-announces[69]]
////

image::images/image04_01_doors.jpeg[Two doors,width=606,height=910]

= Addressing plan

The constitution of this important referential that is the addressing plan is a long process to be carried out iteratively.

The addressing plan is to be built according to the organization's specificities. 
Beyond the elements mentioned in this section, it is necessary to exchange with many interlocutors by forecasting the result of your different plan proposals. 
In any case, think in the long term and keep some free space at the top of the block.

Before getting down to the plan building options, let's start by discussing the prefix choice to operate within the organization.

//save character ◗
=== PUBLIC OR PRIVATE?

Public IPv4 addressing is scarce and is therefore naturally limited to Internet exposure. 
Within the internal network the RFC 1918 ranges including 10.0.0.0/8 prevail.

With IPv6 the question arises to choose between the 2 options.

Depending on your size and activity, the ideal is to have your own prefix assigned by the continental manager (RIR). 
Similarly, a large subsidiary or one with a high degree of independence in terms of IT would be well advised to request its own block from RIR.

You can also get a PI from a sponsor LIR, that’s not expensive at all.

The minimum assignment policy is /32. 
It is possible to obtain larger blocks if the structure's size justifies it.

=== SMALL ORGANIZATION

For a small network, it is possible to use the prefix supplied by the ISP through prefix delegation. 
However, depending on a third-party structure for the addressing of its resources is not ideal and one quickly reaches the limits of this mode, for example for fixed addressing of internal servers. 
There is still the possibility of delegating prefixes with DHCPv6-PD for those who are adept at a sudden change. 
In an ideal world all tools could adapt to prefix renumbering, but in practice it will probably be a long time before all configurations are dynamic.

//[#_Toc88922671 .anchor]####ULA
==== ULA
Private IPv6 addressing appears as a solution, this "equivalent" of the RFC 1918 IPv4 is called ULA for Unique Local Address and corresponds to the FC00::/7 prefix.

In order to limit the risk of conflict with another structure with which you could hypothetically exchange privately one day, for example through an IPSEC tunnel, it is recommended to randomly choose a prefix in this /7 rather than starting from the bottom (RFC4193 even imposes this randomization).

Take for example an arbitrary /48 in FC00::/7 and build your addressing on it. 
For a very small structure a /56 is enough. 
Be careful, the size must not be too large for a reason we will see below. 
RFC4193 proposes a pseudo random generation algorithm to obtain a 40 bits ID, which gives a 48 bits prefix.

However, ULA has a lower priority than IPv4 in the current precedence rules. 
IPv4 will therefore be favored in a dual-stack environment (except for traffic between 2 ULA). 
You have 2 solutions:

* Modify the behavior of all hosts to give ULA priority over IPv4;
* Request an independent PI prefix and use it only internally; this last method is recommended.

//[#_Toc88922672 .anchor]####Provider-Independent (PI) Prefix
==== Provider-Independent (PI) Prefix

Recommended solution, ask for a PI prefix in /48 at a LIR. 
No need to announce it on the internet etc. 
But it will allow you to have a LAN with a unique addressing space and to avoid the ULA vs IPv4 precedence problems.

Packets using this addressing on the LAN (non-advertised PI on the Internet) must undergo a NAT in order to exit on the Internet. 
If in IPv4 we use NAT44 + PAT with stateful session table, here we will use Network Prefix Translation v6 (NPTv6 | RFC 6296).

Prefix Translation swaps the first few bits of the address to match an IPv6 prefix to another of the same size. 
No other changes take place, everything is stateless.

It will be only needed to map its private prefix /56 (or other size) to the public one provided by the carrier to exchange on the Internet while controlling its internal addressing. 
It is possible to map an internal /56 to a chunk of public /48 routed, but not the reverse of course (hence the importance of not picking a too) large range on your LAN.

Thanks to NPTv6, the company can switch from one ISP to another without altering anything internally, and it doesn't break the PMTU-D maximum transmissible size discovery.

//[#_Toc88922673 .anchor]####NPTv6 drawbacks
==== NPTv6 drawbacks

There are still negative sides, firstly protocols encapsulating the address in the payload like SIP, H323, etc. will always require the use of a corresponding Application Layer Gateway (ALG) on the equipment performing the translation. 
As in NAT44, ALGs can be an attack vector, see in particular the recent slipstreaming methods that have forced browser editors to block certain destination ports.

Secondly you will need to synchronize your DNS records between the internal DNS zone (non-announced PI or ULA depending of your choice) and the external zone version for exposed services. 
So, you don’t mistakenly publish an AAAA record with an unreachable IP on the internet in one hand, and you don’t use the Global Routable IP internally on the other hand as it would imply tromboning through the NPTv6 platform. 
For example, a LAN client requesting a DMZ server should reach it using directly towards its internal address (ULA or non-announced PI).

Oh, and don’t forget to create PTR for both types of address, it’s important for some services like SMTP MX as this is part of anti-spam checks. Hopefully there are mechanisms enabling to auto generate PTR.

=== LARGE ORGANIZATION

Start by obtaining a public PI (Provider Independent) prefix, or several in the case of subsidiaries or a multi-continental geographical presence.

Some specificities must be taken into account before building your plan.

Your BGP public announcements cannot, by convention, be smaller than /48. 
(Similar situation to /24 IPv4). 
However, there is no need to dedicate an advertisable prefix that would correspond only to the exposed servers, we will see why.

IPv4 and the omnipresence of NAT44+PAT have brought practices that it is no longer necessary to reproduce in IPv6, in particular the false security feeling offered by NAT44 in inbound. 
The diode aspect is inherently present because of the session tracking requirement, so it is stateful. 
And while it is normal not to have upnp auto-port forwarding as found on consumer equipment, it is more difficult to guard against recent slipstreaming attacks using ALGs as mentioned above.

A stateful NAT + PAT equivalent existed in IPv6, but its use is not recommended. 
In fact NAT-PT (NAT Protocol Translator RFC 2766, not to be confused with NPTv6) is simply not usable and has been archived, see RFC 4966 which states the reasons why this mechanism has been discontinued.

Thus you will sometimes find security recommendations which are to have an internal network in private IPv6, to use NAT in exit in order to make its addressing plan invisible to the outside, etc.

These recommendations are just reminiscent of the IPv4 habits, as well as the fact that using private internal addressing with NPTv6 prefix translation to exit the network has no security interest for a large company, and does not hide the details of the internal plan at all, since it simply switches the first few bits of the address. 
It is important to remember that NAT does not protect, only a firewall with the right ACLs and possibly inspection are effective.

The whole Information System should be addressed with the global public prefix assigned to the company.

//[#_Toc88922675 .anchor]####Management of direct internet access
==== Management of direct internet access

NPTv6 prefix translation can still be used for other situations. 
Let's take a company that wants to use local breakout (LBO) on its campuses in order to reach Internet resources (a SaaS application, for example) without going through its datacenter. 
The traffic will then have to go from an address that belongs to the company to one that is provided by the local internet carrier of the campus.

Note that this frequent use is a reason to have site prefixes based on a geographical assignment. 
This enables you to have only one NPTv6 rule. 
If your site addressing is fragmented you will have to map each local /64 to a /64 belonging to the prefix provided by the local carrier (typically a /48). 
This means more rules and more work.

A more subtle deviation from this local breakout use case, if the campus is very large and the local carrier allows it, it is possible for the site to advertise its own /48 (or more) via BGP directly on the Internet.

In this case, the site's devices use the addresses of a prefix that we will call "Site" /48, this prefix is not announced but a larger prefix "Global" /32 which includes it is announced by the datacenter. 
Finally, the site announces locally and directly on the Internet a prefix "LBO" /48 which also belongs to the global /32. 
This setup would cause a huge increment in internet BGP Fullview but would be still usable if the plan allows for a route aggregation at the carrier edge.

The local rule of NPTv6 translates the Site/48 prefix into LBO/48 at the local internet exit. 
The operation of the routing decisions of BGP privileging fine routes will allow the whole to function without conflict, with thus this time IPs which all belong to the company. 
If we have several sites in this situation with the same provider, it would be smart to ask to aggregate the announcements.

Finally, some traffic will leave the site directly via the LBO prefix, while other traffic that must undergo more advanced processing in DC will leave via the Site prefix (depending on the configuration of the workstations' proxification).

The emergence of so-called "SASE" (Secure Access Service Edge) solutions can make it possible to dispense with DC processing altogether, in which case it is no longer necessary to use two prefixes with NPTv6.

The latency gain offered by LBO can be significant, as the DC and its dependencies are no longer used. 
However, the same level of security must be ensured in terms of filtering, antivirus analysis, etc. 
The strategy will therefore vary between authorizing some of the flows (recipients with a sufficient level of trust) and all Internet traffic, depending on the level of protection that can be achieved. 
Whether it is provided locally via VNFs, SASE or via a Cloud solution.

.Schema of NPTv6 PI+FAI
image::images/image04_02_nptv6.svg[Schema of NPTv6,width=566,height=318]

For infrastructures that need to be completely isolated from the Internet and any partner (such as a SCADA network), it is possible to use ULA addresses. 
This does not prevent rebound attacks from another internal system, firewalls are sufficient to block traffic at the edge of these networks anyway. 
The contribution of ULA is therefore almost null and remains a subjective choice. 
Again, we recall that ULA has a lower priority than IPv4 in the current precedence rules. 
IPv4 will therefore be preferred in a dual-stack environment.

=== LOGICAL GROUPS

Historically, IPv4 accustomed us to assign ranges by location in order to minimize the number of routes by summarizing, more recently some projects might have made the opposite assessment, i.e. assigning the geographical location from a block dedicated to a specific use as in a WiFi deployment project in agencies or IoT.

This last case is beneficial to filtering because it is focused on usage rather than location.

The choice is especially important because, unlike IPv4, you cannot use a mask, only the prefix to filter.

In IPv4, it is possible, even if rarely used, to use for example the wildcard 0.0.240.0 to select n identical hosts from different subnets. 
In v6 this disappears.

If devices support a large number of routes, manual rules applied to routes would become complex to implement with a usage-centric plan, and we already know that despite automation and the arrival of SDN on different perimeters, BGP will remain the way to interconnect "black boxes" between them. Nevertheless, it would still be possible to use scripts and a route server like https://bird.network.cz/[bird] or https://frrouting.org/[FFRouting] to automatically perform classifications and apply policies or simply to make the best use of communities on announcements.

The 2 geo or type centric options have advantages and disadvantages, which can be compensated by automation (Consolidation of filtering rules VS Consolidation of routes and sites). 
As stated before with NPTv6 explanation, it’s easier to base addressing on location.

=== BUILDING BLOCKS

The slicing can privilege the multiples of 4 bits (hexadecimal characters), /32, /48, /52 etc in order to facilitate reading, tendency which corresponds to our habit of slicing the IPv4 by octet and which leads to waste in the exact case of v4.

The grouping of 4 characters is called a Hextet, for example: A9B4:

Each hexa character can be named a nibble.

Therefore, we remind that if v6 offers a large number of addresses, this should not be an invitation to waste, we will avoid, for example, leetspeak such as ”c01d:c01a:c0fe” / “cold cola cofe” within the prefix/network ID.

One can immediately think of associating these blocks of characters with:

* Legal Entity / Sector of Activity;
* Geographic location ID;
* Network type;
* VLAN or VNI number;
* Operator;
* Device Model.

Numerical elements can be kept as they are, taking more space, or encoded in hexadecimal, eliminating human readability.

For example, to store the VLAN number, from 0 to 4094 (12 bits) we have the choice:

* 4 0 9 6 which is 4 characters so 16 bits;
* F F E or 3 characters to form 4094 in hexadecimal, with a free hexa character remaining in the hextet x F F E.

In the case where we create a new reference frame, like the network types, it would be better to write them directly in hexadecimal if the division allows it.

If we go back to the list of building blocks, some of them have a life cycle unsuitable for integration in an addressing plan. 
For example, the carrier may change in the meantime, as may the manufacturer and model of a level 3 device. 
(We know from experience that the maintenance and change would not be passed on because "it works well as it is"). 
We will later see an exception for interconnection.

In the datacenter, the same thing will happen with VLANs, the use of E-VPN + VxLAN technologies with a 24-bit VNI number will relegate the VLAN to the background, the same goes for proprietary segmentation technologies that integrate notions of client tenant, resource pool, etc.

From this we can deduce that the plan must only integrate elements that are relevant and static in time, which gives us:

* The division / entity at a high level in order to allow the breakdown of the structure (as is done in an Active Directory);
* The location either by continental tree / plate / site, or by the numbered site code;
* The type of network, with subcategories to facilitate the management of filtering and to delegate part of the addressing plan.

=== PREFIX SIZE

//[#_Toc88922679 .anchor]####Standard
==== Standard
From the outset, /64 appears to be the unalterable standard for a network (RFC 4291), particularly for the auto-configuration mechanism SLAAC to work.

.Is a standard actually a standard?
image:images/image04_03_slash64warfront.png[The /64 RFC warfront,width=546,height=279]

//==== image:extracted-media/media/image40.svg[extracted-media/media/image40,width=68,height=49] 

The norm is /64, using anything else to connect hosts might cause unexpected behavior or incompatibilities.

Regarding site prefixes, the recommendations have also evolved, RFC 6177 adjusts the prefix to the real need, whereas previously /48 was mandatory.

Operators generally assign a /56 or /60 to domestic customers, and /48 to professionals. 
The terminal networks are always in /64, except for the interconnections.

//[#_Toc88922680 .anchor]####Interconnection
==== Interconnection

Carriers seem to recommend /125 interconnections. 
In order to cut between 2 hexadecimal characters, it would be a good idea to provide /124 in the plan and use the 125th for failover when changing equipment or provider.

This reservation does not prevent you from setting the point-to-point interfaces to /127.

These reservations for interconnections and loopbacks can be inherited from the site addressing, or on the contrary from a /64 prefix dedicated to be divided into /124 and more for interconnections.

In the latter case you will need to advertise many fine routes on your network.

Building interconnections with link-locals works but has many drawbacks detailed in RFC 7404 (no interface ICMP return because not routable but loopback one instead, address that changes in case of hardware replacement as auto based on EUI-64 MAC, etc.) 
On the other hand, one of the big advantages is the lightening of the routing tables as well as the reduction of the attack surface. 
The path tracing aspect with link-local can be retrieved with RFC 5837. 
The choice will therefore generally be different between a corporate network VS a large ISP or a GIX exchange point.

You can build your interco /124 prefix with the BGP AS number of the third party, the router ID, etc. 
In short everything that will help you in your daily tasks.

Be careful with IPAMs, they often refuse to let you register anything else than /64, however it is not abnormal to have interconnections with long prefixes.

Apart from interconnections, /64 is the current standard and it would be a shame to venture to use something else.

[CAUTION]
====
Some RFC drafts aim at allowing SLAAC to provide something else than /64, see draft-mishra-v6ops-variable-slaac-problem-stmt and draft-mishra-6man-variable-slaac. These drafts try to solve the problem of subdivision of a single /64 provided for example by a mobile carrier via 3GPP link. The objective is to be able to create different networks on mobile micro-infrastructures, typically a router with multiple client networks or a connected vehicle whose different internal networks sometimes use Ethernet, sometimes BUS and cannot be bridged. It is even necessary to have direct exchange networks with neighboring vehicles (V2V). Future will tell if theses drafts become a standard or if they are abandoned in the event all carriers start supporting DHCP-PD on cell phones with /56 via 3GPP as it is often the case for home connections.
====

=== COMMON SERCVICES ADDRESSES

For convenience, it is interesting to assign short addresses to services for which the IP must often be entered manually, of course first of all the DNS servers, but also the routers' interfaces.

Thus, the address set at the very beginning of an organization, pre:fix:0000:0000:... should be dedicated to fine allocations to facilitate the work of the operators/administrators by allowing them to retain them from the top.

On each plan level, regional plate, site... it would be good to reserve the 0 and 1 for services using shortened addresses. 
Again, to facilitate day-to-day tasks.

However, do not forget to not put all instances of the same service within the same prefix. 
Having for example all the DNS or SMTP relays in the same prefix and therefore depending on the same route is not a good practice. 
In case of a routing incident affecting this prefix you can have as many physical and/or logical instances of the service as possible, it will still result in a blackout.

=== TIME-SCALE EVOLUTION

In order to accommodate migrations at different levels, migration bits can be implemented.

A network migration bit can facilitate changes in hardware, WAN links etc. 
This bit should be 64th in order to be taken into account in /63 filtering rules. 
It would allow transitions of subnets, VLANs, devices in a progressive way without any other modification since the ACLs in /63 would encompass the 2 usable /64.

For example, a campus changes its core and migrates to a MAN at the same time. 
The new networks are set with the transition bit and routed in parallel with the old ones. 
Business tests can take place on the new infrastructure before the migration thanks to the wide filtering including this bit. 
This avoids big bang migrations and limits the discovery of post migration incidents.

At the next changeover the bit is toggled. 
No state between 0 and 1 is preferred.

Any operation involving a change of equipment, operator, move, etc. is therefore greatly facilitated.

However, it is important to prevent the announcement of a twin network that would unintentionally take advantage of global filtering rules. 
Monitoring the origin of routes belonging to the same migration pair is a necessity.

In a more general manner, keep place for future frames of reference. 
This to allow to cope with new architectures without requiring top level new blocks.

.Example of reference frame hierarchy
image::images/image04_04_plan.svg[Frame hierarchy,width=568,height=232]

//==== image:extracted-media/media/image40.svg[extracted-media/media/image40,width=68,height=49] 

=== USE OF HOST NUMBER 0

In IPv6 there is no more network number address nor broadcast address, all possible addresses can be assigned to the hosts.

However, bad regex are sometimes present in configuration fields of applications. 
One can find bugs in systems that do not support being configured with an address ending in ::0, for example ABCD:1234::/64. Sometimes on their interface or on the interface of a third party element like the DNS or NTP server address.

Also, we recommend avoiding addresses with host numbers in 0 at a minimum for servers that may be configured literally in devices such as printers, cameras, and any embedded equipment.

Using DNS limits the risk, except for DNS itself. 
Keeping a final 1 to the addresses of your DNS servers can prevent this type of problem, even if it tends to disappear.

The use of this first available address also raises the question of the confusion risk between address and prefix. 
In IPv4 the network address can never be used for a host (except in the particular case of /31 RFC 3021 intercos) whereas in IPv6 it is possible to have the same address indicating a prefix and a host, the size of the prefix being then the only delimiting factor. 
For example a host ABCD:1234::/128 belonging to the network ABCD:1234::/64.

For this 2nd reason of human readability, it is better not to use the host address 0 at all.

=== PER INTERFACE ISOLATION

Some technical or security constraints may result in instantiating several network interfaces on servers. 
For example, specific security strategies require dedicated management interfaces. 
Sometimes the interfaces used by backup agents are also compartmentalized for performance and isolation reasons.

This raises the question of the output interface choice. 
The IPv4 stack of a system will use a metric to choose the interface carrying the route 0.0.0.0/0, the other interface(s) being limited to only route the subnet to which they are each bound. 
It is then up to the server administrator to set static routes, or the network to perform NAT so that an administration flow arrives via a NAT address belonging to the same subnet as the administration interface.

What about IPv6? The short RFC 7608 states that the routing decision should be based on a bitwise comparison of the machine's interfaces with the destination address. 
The interface with the most common bits wins the race.

Thus, a machine with 2 cards of address ABBA:CAFE::5 and ABBA:1001::5 and sending a packet to ABBA:C9D6::6 will use the first of the 2 cards.

This point should be taken into account in your addressing plan in order to reserve a high level prefix for administration or backup. 
This will facilitate the use of dedicated interfaces if necessary.

Does another method exist to force use of a specific interface to an off-link prefix without modifying the host configuration and without having pre-established a plan based on the RF 7608?

With IPv4 the use of the DHCP option 121 (classless static routes) allows to push fine routes to an interface (NB: this option overwrites the default route that has been advertised, which has to be copied to an option 121 if it is to be advertised).

Nothing similar in IPv6, announcing a prefix via the Router Advertisement with the L bit (on-link) at 0 will not result in learning an indirect route. 
As for DHCPv6, it does not include an equivalent to option 121.

The RFC 4191 suggests an extension (type 24) to the RA allowing to announce routes, written by Microsoft it works since Windows Vista, the Linux kernel also implements it since the commit 930d6ff and ebacaaa of 2006. 
However, the option is not necessarily enabled.

Be careful, this RFC has 2 parts, one is about the correct handling of the RA priority, the other one deals with additional routes.

If you cannot use the option, you can always try to send prefixes with the on-link option set to 1. 
The hosts will then add a route to the router for this prefix. 
However, this is a divergence from the standard.

//=== image:extracted-media/media/image26.svg[Empreintes contour,width=75,height=75]◗ Mariginalspalte ??
=== IP V4 / V6 MAPPING

As discussed in the dual-stack section, the parallel use of IPv4 and IPv6 leads to extra configuration and operation, and therefore to extra costs.

Good practices can facilitate the implementation of automations that reduce these efforts.

//[#_Toc88922686 .anchor]####Network prefix number
==== Network prefix number

It is important to have a mapping database between an IPv4 network and the corresponding IPv6 network. 
The ideal is to have this functionality within the IPAM, or alternatively to use a field in the IPv6 section of the IPAM to indicate the associated IPv4 network with its mask.

If the IPAM cannot store this information in any way, even by circumvention, then a third party inventory tool will have to be used. 
This can be another IT repository, a dedicated database, etc. 
The important thing is that the repository is API-enabled so that it can be requested from other systems.

Let's take the example of firewall filtering rules, recreating all existing rules in IPv6 during deployment and then double the flow opening request process would be far too cumbersome.

Instead, it is possible to implement automations that examine every night whether each object representing an IPv4 network does not have an IPv6 match, and if so, modify the object to add the associated IPv6 prefix. 
This prevents errors, whether they come from the firewall administrator or from applicants who might make a mistake about the IPv6 prefix when requesting to open a flow.

With a more advanced solution, it is possible to manage changes synchronously, without worrying about the dual-stack.

//[#_Toc88922687 .anchor]####Host number / Interface ID
==== Host number / Interface ID

In the second half of the address are the 64 bits dedicated to host identification. 
Here again, good practices exist to facilitate the mapping of the IPv4 and IPv6 address of a dual-stack host.

These practices are obviously only valid with stateful DHCPv6 or manual addressing.

The easiest way is to keep the IPv4 number and carry it over to IPv6. 
Let's take the network 10.2.3.128/25 and a server 10.2.3.239. 
After IPv6 deployment, this network arbitrarily uses in the following prefix ABBA:CAFE::/64.

Numbering the server ABBA:CAFE::239 facilitates operation up to the human readability level. 
One can also use the hexadecimal ABBA:CAFE::EF if one wants the values to keep the same strict numbering from a binary point of view. 
However, readability is lost.

Another option is to keep the ordinal nature instead of the number. 
With this same network, we see that the server uses the 89th usable IPv4 of the network 10.2.3.128/25 (239-129=110) .128 is the network number and is not assignable here in IPv4.

This ordinal pattern results in ABBA:CAFE::110 or ABBA:CAFE::6E in pure hexadecimal.

The most meticulous among you will have noticed that the host number ::0 is usable in IPv6 since there is no network number and broadcast address, based on this postulate one could also convert in the ordinal mode an IPv4 .1 address into IPv6 ::0. 
However, this is not practical in terms of reading because of the risk of confusion with a prefix, and can also cause problems on systems, for example because of poorly implemented field checks as previously said.

The choice between these 2 methods and the 2 counterparts (decimal or hexadecimal) is to be discussed. 
The first one in its decimal version is clearly the most practical, but other criteria may come into play as we get closer to an orchestrated world.

Here are a few examples:

[width="100%",cols="21%,15%,31%,33%",options="header",]
|===
|IPv4 Network |IPv4 Host |IPv6 host num - Mapping |IPv6 host num - Ordinal
|10.2.3.128\|25 |10.2.3.239 |::239 dec \|::EF hex |::110 dec \|::6E hex \| 239-129
|10.2.4.0\|24 |10.2.4.239 |::239 dec \|::EF hex |::239 dec \|::EF hex \| 239
|10.5.0.0\|23 |10.5.0.239 |::239 dec \|::EF hex |::239 dec \|::EF hex \| 239
|10.5.2.0\|23 |10.5.3.239 a|
Relative ::1239 dec \|::4D7 hex

Absolute ::3239 dec \|::CA7 hex

|::495 dec \|::1EF hex\|(256+239)
|10.6.0.0\|16 |10.6.28.239 a|
::28239 dec \|::6E4F hex

28 * byte+239

a|
::7407 dec \|::1CEF hex

(28x256) + 239

| |10.6.28.3 a|
::28003 dec \|::6D63 hex

28 * byte+003

a|
::7171 dec \|::1C03 hex

(28x256) + 3

|10.8.64.0\|18 |10.8.72.50 a|
Relative ::8050 dc \|::1F72 hex

(72-64)=8 blocs + 050

Absolute ::72050 d\|::11972 hx

a|
::2098 dec \|::832 hex

(8x256) + 50

|===

We see with the example table that for an IPv4 network split at the level of the last byte (/24), the ordinal has the same value as the mapping, since the counting starts at 0 in both cases.

It becomes more complex with an IPv4 network larger than one byte, in the example a /23. 
What should we do here to distinguish 10.5.0.239 from 10.5.1.239 ? 
Adding a 1 to indicate that we are moving beyond the last byte seems to be a good method. We then count all the addresses of the /24 constituting the network, including unassignable addresses, that is 256.

But the quest for readability could also have led us to recopy the previous byte and define ::3239 rather than ::1239, thus migrating from a relative to an absolute reference. 
Moreover we can even copy the whole host's IPv4 into its IPv6 host number, not the most elegant solution though.

The following examples also illustrate the need to keep the 0's of the bytes in the "Mapped" mode in order not to generate duplicates. 003, 050, etc.

As you can see, the important point is to define the engineering rules clearly and to stick to them.

To sum up :

* The decimal carryover mode in absolute, i.e. copying the full byte, or even 2 bytes for networks larger than /24 (etc.) clearly wins for matching readability. However, it implies long host addresses;
* The use of hexadecimal is probably only advantageous in an automated environment;
* 2 BE or not 2 BE, the use of hexa and powers of 2 make the intellect work;
* Again, these solutions will allow the generation of ACLs, etc. without having to work twice.

The mapping can also be done via the DNS A and AAAA records of each server, which then requires another form of accuracy.

Regarding hosts, there does not seem to be any product today that allows without prior configuration to assign the same host number in IPv4 and IPv6 based on an integrated IPAM mapping.

=== FOR NATIVE V6 NETWORKS

When setting up a native IPv6 network, the previous rules related to hosts do not apply. 
You can then use part of the 64 bits to indicate host details.

For example a letter to indicate a desktop server, another character to specify a printer. 
This should remind you of existing engineering rules / naming conventions for hostnames.

In a datacenter you can think of tagging the business associated with a VM, etc.

However, this remains complex and redundant with a CMDB, especially since the address cannot be changed easily if needed.

The other solution, at least on the server side, is to fix the interface ID so that it is static and does not depend on the MAC address (and therefore does not change when the card is changed, physical or virtual, and does not expose the manufacturer in the address). 
In conjunction with SLAAC for the provision of the prefix. 
This solution remains simpler than a manual setup everywhere.

In general, it is only necessary to define a range segmentation in small multi-purpose networks on small sites.

=== PUBLIC ANNOUNCES

What to advertise on the internet?

To that question, some will answer "As limited resources as possible". 
In fact, does directly announcing its /32 instead of some /44 DMZ really represent a surface attack reduction? 
Will it matter when implementing stateful and IPS firewalls? 
The end-to-end IPv6 goal will probably end up pushing wide advertisements anyway.

Looking at the BGP IPv6 table contents, we find that the majority of advertisements are /32, /40, /44 and /48.

.Distribution of prefixes
image::images/image04_05_prefixes.png[Prefix distribution,width=222,height=364]

The /48 advertisements represent half of the advertisements in number, with 54,000 routes, but not in volume of unique addresses, since each /32 contains 65,536 (2e16) times more addresses than a /48.

http://bgp.potaroo.net/v6/as6447/

https://bgp.potaroo.net/index-v6.html

https://www.cidr-report.org/v6/as2.0/

The last URL notably displays the following weekly report with the observed prefix additions and deletions.

//==== image:extracted-media/media/image40.svg[extracted-media/media/image40,width=68,height=49]

Weekly IPv6 announces delta https://cidr-report.org/v6/as2.0/ 

[CAUTION]
====
Some anti-DDoS solutions work by re-announcing the attacked prefix via a "cleaning" network. The /48 being the smallest, you will have to announce more in nominal if you run this type of solution.

Ideally, advertise in a large way according to the geographical locations of your exit nodes. IPv6 peering can also be an opportunity to experiment with RPKI route signing if you don't already do it, or to experiment with RTBH and Flowspec.
====

//#### End of chapter ####